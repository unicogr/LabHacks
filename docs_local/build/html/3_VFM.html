
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>3. pRF mapping &#8212; researchLog  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. References" href="References.html" />
    <link rel="prev" title="2. Surface-based fMRI" href="2_fMRI.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Research Log</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1_Sphinx.html">1. <span style="color:black">Research handbook</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="2_fMRI.html">2. <span style="color:black">Surface-based fMRI</span></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. <span style="color:black">pRF mapping</span></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#questions">3.1. <span style="color:lightblue">Questions? ðŸ¦‰</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-part-prf-mapping">3.2. <strong>1st part</strong>:  pRF mapping</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="References.html">4. <span style="color:black">References</span></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Codebook:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">myCodeIsYourCode</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="2_fMRI.html" title="previous chapter"><span class="section-number">2. </span><span style="color:black">Surface-based fMRI</span></a></li>
      <li>Next: <a href="References.html" title="next chapter"><span class="section-number">4. </span><span style="color:black">References</span></a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="2_fMRI.html" title="Previous document"><span class="section-number">2. </span><span style="color:black">Surface-based fMRI</span></a>
        </li>
        <li>
          <a href="References.html" title="Next document"><span class="section-number">4. </span><span style="color:black">References</span></a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="prf-mapping">
<h1><span class="section-number">3. </span><span style="color:black">pRF mapping</span><a class="headerlink" href="#prf-mapping" title="Permalink to this heading">Â¶</a></h1>
<p>In this tutorial, we will learn how to use <a class="reference external" href="https://github.com/VU-Cog-Sci/prfpy">prfpy</a> to compute population receptive field maps using 7T-fMRI.</p>
<p>We will use the <em>iCORTEX 7T-fMRI</em> dataset to illustrate how to apply slice timing correction, motion compensation within and between runs, distortion correction, and co-registration with the freesurferâ€™s anatomy.</p>
<blockquote>
<div><p><strong>Goals</strong></p>
</div></blockquote>
<ul class="simple">
<li><p>Align repeated runs of a visual field mapping fMRI acquisition.</p></li>
<li><p>Set up the right search grids for pRF parameter optimization.</p></li>
<li><p>Run pRF modelling using parallelization.</p></li>
<li><p>Plot the pRF maps on a flattened cortical reconstruction and as interactive an 3D surface.</p></li>
</ul>
<p>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-center"><p><a class="reference internal" href="_images/sub-01_iso_averaged_lh_pRF_maps_with_colorbars.png"><img alt="" class="align-center" src="_images/sub-01_iso_averaged_lh_pRF_maps_with_colorbars.png" style="width: 1200px;" /></a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><strong>Retinotopic maps in early visual cortex for a single hemisphere</strong>. Population receptive field (pRF) parameters (eccentricity, polar angle, size) were estimated for BOLD data interpolated to the cortical surface. circular region of interest (ROI) was defined on the cortical surface, centered on FreeSurferâ€™s probabilistic V1 label. The resulting pRF estimates revealed eccentricity representations (left) and polar angle organization (right). Data shown for a single subject (BOLD data were averaged across four runs).</p></td>
</tr>
</tbody>
</table>
<section id="questions">
<h2><span class="section-number">3.1. </span><span style="color:lightblue">Questions? ðŸ¦‰</span><a class="headerlink" href="#questions" title="Permalink to this heading">Â¶</a></h2>
<script src="https://giscus.app/client.js"
        data-repo="nicogravel/researchLog_template"
        data-repo-id="R_kgDON90EnA"
        data-category="Giscus!"
        data-category-id="DIC_kwDON90EnM4CnVS9"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="gruvbox"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
</section>
<section id="st-part-prf-mapping">
<h2><span class="section-number">3.2. </span><strong>1st part</strong>:  pRF mapping<a class="headerlink" href="#st-part-prf-mapping" title="Permalink to this heading">Â¶</a></h2>
<section id="we-use-and-neuropythy-and-prfpy-to-compute-prf-parameters-for-a-flattened-cortical-reconstruction-on-single-subject-and-using-a-single-run">
<h3><span class="section-number">3.2.1. </span>We use and <code class="docutils literal notranslate"><span class="pre">neuropythy</span></code> and <code class="docutils literal notranslate"><span class="pre">prfpy</span></code> to compute pRF parameters for a flattened cortical reconstruction on  single subject and using a single run<a class="headerlink" href="#we-use-and-neuropythy-and-prfpy-to-compute-prf-parameters-for-a-flattened-cortical-reconstruction-on-single-subject-and-using-a-single-run" title="Permalink to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">six</span> <span class="c1"># six provides python 2/3 compatibility</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>


<span class="c1"># The neuropythy library is a swiss-army-knife for handling MRI data, especially</span>
<span class="c1"># anatomical/structural data such as that produced by FreeSurfer or the HCP.</span>
<span class="c1"># https://github.com/noahbenson/neuropythy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">neuropythy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ny</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipyvolume</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ipv</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">nilearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">image</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="n">plotting</span><span class="p">,</span> <span class="n">signal</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">nibabel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">prfpy.stimulus</span><span class="w"> </span><span class="kn">import</span> <span class="n">PRFStimulus2D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">prfpy.model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iso2DGaussianModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">prfpy.fit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iso2DGaussianFitter</span>


<span class="c1"># Load the time series</span>
<span class="n">load_path</span> <span class="o">=</span> <span class="s1">&#39;/home/nicolas/Documents/Paris/UNICOG/Analyses/fMRIdata/iCORTEX/sub-00/retinotopy/&#39;</span>
<span class="n">V1_ts_lh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">load_path</span> <span class="o">+</span> <span class="s1">&#39;V1_ts_lh.npy&#39;</span><span class="p">)</span>
<span class="n">V1_ts_rh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">load_path</span> <span class="o">+</span> <span class="s1">&#39;V1_ts_rh.npy&#39;</span><span class="p">)</span>


<span class="n">fs_pth</span> <span class="o">=</span> <span class="s1">&#39;/home/nicolas/Programas/freesurfer-linux-ubuntu22_amd64-7.4.0/freesurfer/subjects/&#39;</span>
<span class="n">subject_id</span> <span class="o">=</span> <span class="s1">&#39;sub-00_iso&#39;</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">ny</span><span class="o">.</span><span class="n">freesurfer_subject</span><span class="p">([</span><span class="n">fs_pth</span> <span class="o">+</span> <span class="n">subject_id</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="get-v1-coordinates-fom-the-fsaverage-registration-of-the-subject">
<h3><span class="section-number">3.2.2. </span>Get V1 coordinates fom the fsaverage registration of the subject<a class="headerlink" href="#get-v1-coordinates-fom-the-fsaverage-registration-of-the-subject" title="Permalink to this heading">Â¶</a></h3>
<p>We did this in step  2.3.14. No we jujst load these:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the time series</span>
<span class="n">load_path</span> <span class="o">=</span> <span class="s1">&#39;/home/... ... fMRIdata/iCORTEX/sub-00/retinotopy/&#39;</span>
<span class="n">v1_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">load_path</span> <span class="o">+</span> <span class="s1">&#39;v1_centers.npy&#39;</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">v1_rights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">load_path</span> <span class="o">+</span> <span class="s1">&#39;v1_rights.npy&#39;</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>


<span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;orthographic&#39;</span> <span class="c1"># or: equirectangular, sinusoidal, mercator</span>
<span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span> <span class="c1">#np.pi/2</span>

<span class="c1"># Now, we make the projections:</span>
<span class="n">map_projs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lh&#39;</span><span class="p">,</span> <span class="s1">&#39;rh&#39;</span><span class="p">]:</span> 
<span class="c1">#for h in [0, 1]:     </span>
    <span class="n">mp</span> <span class="o">=</span> <span class="n">ny</span><span class="o">.</span><span class="n">map_projection</span><span class="p">(</span><span class="n">chirality</span><span class="o">=</span><span class="n">h</span><span class="p">,</span>
                           <span class="n">center</span><span class="o">=</span><span class="n">v1_centers</span><span class="p">[</span><span class="n">h</span><span class="p">],</span>
                           <span class="n">center_right</span><span class="o">=</span><span class="n">v1_rights</span><span class="p">[</span><span class="n">h</span><span class="p">],</span>
                           <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                           <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                           <span class="n">registration</span><span class="o">=</span><span class="s1">&#39;native&#39;</span><span class="p">)</span>
    <span class="n">map_projs</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">mp</span>

<span class="c1"># See what this created.</span>
<span class="n">map_projs</span>

<span class="n">flatmaps</span> <span class="o">=</span> <span class="p">{</span><span class="n">h</span><span class="p">:</span> <span class="n">mp</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">hemis</span><span class="p">[</span><span class="n">h</span><span class="p">])</span> <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">mp</span><span class="p">)</span> <span class="ow">in</span> <span class="n">map_projs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">flatmaps</span>

<span class="n">lh_cortex_label</span> <span class="o">=</span> <span class="n">flatmaps</span><span class="p">[</span><span class="s1">&#39;lh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">rh_cortex_label</span> <span class="o">=</span> <span class="n">flatmaps</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">lh_cortex_label</span>
</pre></div>
</div>
</section>
<section id="prepare-stimulus">
<h3><span class="section-number">3.2.3. </span>Prepare stimulus<a class="headerlink" href="#prepare-stimulus" title="Permalink to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pRF_images_path</span> <span class="o">=</span><span class="s1">&#39;/home/... .../iCORTEX/pRF_log_images/&#39;</span>

<span class="c1"># Initialize an empty list to store the data</span>
<span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop through the files in the folder</span>
<span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">150</span><span class="p">):</span>
    <span class="c1"># Load the .png file</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pRF_images_path</span><span class="p">,</span><span class="s1">&#39;run5_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Stack the data along the third dimension to create the design matrix</span>
<span class="n">design_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Design matrix shape: </span><span class="si">{</span><span class="n">design_matrix</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">clear_output</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">design_matrix</span><span class="p">)[</span><span class="mi">2</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">design_matrix</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Frame </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



<span class="c1"># screen size parameters</span>
<span class="n">screen_height_cm</span>   <span class="o">=</span> <span class="mf">39.29</span> <span class="c1">#69.84 #12.65</span>
<span class="n">screen_size_cm</span>     <span class="o">=</span> <span class="n">screen_height_cm</span><span class="o">/</span><span class="mi">2</span> 
<span class="n">screen_distance_cm</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1">#5.0</span>

<span class="c1"># calculate max stim ecc</span>
<span class="n">max_ecc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">screen_size_cm</span><span class="o">/</span><span class="n">screen_distance_cm</span><span class="p">)</span>
<span class="c1">#max_ecc = math.atan(screen_height_cm/screen_distance_cm)/np.pi*2; # in degrees</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Max ecc in rad: &#39;</span><span class="p">,</span> <span class="n">max_ecc</span><span class="p">)</span>
<span class="n">max_ecc_deg</span>        <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">max_ecc</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Max ecc in deg: &#39;</span><span class="p">,</span> <span class="n">max_ecc_deg</span><span class="p">)</span>
<span class="n">max_ecc_deg</span>

<span class="n">prf_stim</span> <span class="o">=</span> <span class="n">PRFStimulus2D</span><span class="p">(</span><span class="n">screen_size_cm</span><span class="o">=</span><span class="n">screen_size_cm</span><span class="p">,</span>
                             <span class="n">screen_distance_cm</span><span class="o">=</span><span class="n">screen_distance_cm</span><span class="p">,</span>
                             <span class="n">design_matrix</span><span class="o">=</span><span class="n">design_matrix</span><span class="p">,</span>
                             <span class="n">TR</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="compute-prfs">
<h3><span class="section-number">3.2.4. </span>Compute pRFs!<a class="headerlink" href="#compute-prfs" title="Permalink to this heading">Â¶</a></h3>
<p>We first set the grid search. Setting a biophysically meaningful and computationally feasible grid for the optimisation of the pRF position and size parameters, as well as boundaries for only positive pRF is crucial, as it will allow converging fast and accurately to the best solution (by grid search based <em>least squares minimisation</em>). Importantly, <code class="docutils literal notranslate"><span class="pre">n_procs</span></code> is crucial, in my personal computer I can use up to 8 workers. In a high performance cluster more can be used. The more workers, the faster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">normalize_RFs</span><span class="o">=</span><span class="kc">True</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data shape: &#39;</span><span class="p">,</span> <span class="n">V1_ts_lh</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">V1_ts_lh</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data shape: &#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># pRF type</span>
<span class="n">n_procs</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">gg</span> <span class="o">=</span> <span class="n">Iso2DGaussianModel</span><span class="p">(</span><span class="n">stimulus</span><span class="o">=</span><span class="n">prf_stim</span><span class="p">,</span><span class="n">normalize_RFs</span><span class="o">=</span><span class="n">normalize_RFs</span><span class="p">)</span>
<span class="n">gf</span> <span class="o">=</span> <span class="n">Iso2DGaussianFitter</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">gg</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_procs</span><span class="p">)</span>

<span class="c1"># Gid fit</span>
<span class="n">ecc_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">polar_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
<span class="n">size_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">max_ecc_size</span>  <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">max_ecc_deg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>        
<span class="n">n_batches</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1">#IMPORTANT: fixing bold baseline to 0 (recommended), and only allowing positive prfs</span>
<span class="c1">#fixed_grid_baseline=0</span>
<span class="n">gauss_grid_bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span> <span class="c1"># bound on prf amplitudes (only positive)</span>


<span class="n">gf</span><span class="o">.</span><span class="n">grid_fit</span><span class="p">(</span><span class="n">ecc_grid</span><span class="o">=</span><span class="n">ecc_grid</span><span class="p">,</span>
            <span class="n">polar_grid</span><span class="o">=</span><span class="n">polar_grid</span><span class="p">,</span>
            <span class="n">size_grid</span><span class="o">=</span><span class="n">size_grid</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">n_batches</span><span class="o">=</span><span class="n">n_batches</span><span class="p">,</span>
            <span class="n">grid_bounds</span><span class="o">=</span><span class="n">gauss_grid_bounds</span><span class="p">)</span>
            <span class="c1">#fixed_grid_baseline=fixed_grid_baseline, </span>

</pre></div>
</div>
<p>Once the grid search has been defined we can continue with the iterative search, we must set the <code class="docutils literal notranslate"><span class="pre">rsq_threshold</span></code> to a small but not <em>too</em> small number. This is important. Too small, and we will get stuck on a local minima and never converge (it will take longer to compute and the solution will be wrong).</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Iterative fit</span>
<span class="c1"># </span>
<span class="nv">rsq_threshold</span><span class="o">=</span><span class="m">0</span>.001
<span class="nv">verbose</span><span class="o">=</span>True
<span class="nv">gauss_bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[(</span>-17.5,<span class="w"> </span><span class="m">17</span>.5<span class="o">)</span>,<span class="w">  </span><span class="c1"># x</span>
<span class="w">                </span><span class="o">(</span>-17.5,<span class="w"> </span><span class="m">17</span>.5<span class="o">)</span>,<span class="w">  </span><span class="c1"># y</span>
<span class="w">                </span><span class="o">(</span><span class="m">0</span>.5,<span class="w"> </span><span class="m">15</span><span class="o">)</span>,<span class="w">  </span><span class="c1"># prf size</span>
<span class="w">                </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>,<span class="w">  </span><span class="c1"># prf amplitude</span>
<span class="w">                </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">)]</span><span class="w">  </span><span class="c1"># bold baseline</span>
<span class="nv">gauss_bounds</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">[(</span><span class="m">0</span>,10<span class="o">)</span>,<span class="o">(</span><span class="m">0</span>,0<span class="o">)]</span><span class="w"> </span><span class="c1">#hrf bounds. if want it fixed to some value, specify e.g. (4,4) (0,0)</span>




<span class="c1">#iterative fit acts as a wrapper of optimize.minimize and passes all the arguments</span>
gf.iterative_fit<span class="o">(</span><span class="nv">rsq_threshold</span><span class="o">=</span>rsq_threshold,<span class="w"> </span>
<span class="w">                 </span><span class="nv">verbose</span><span class="o">=</span>verbose,<span class="w"> </span><span class="nv">bounds</span><span class="o">=</span>gauss_bounds<span class="o">)</span>
</pre></div>
</div>
<blockquote>
<div><p>Output:</p>
</div></blockquote>
<p>[Parallel(n_jobs=8)]: Using backend LokyBackend with 8 concurrent workers.<br />
[Parallel(n_jobs=8)]: Done  34 tasks      | elapsed:    8.7s<br />
[Parallel(n_jobs=8)]: Done 184 tasks      | elapsed:   36.7s<br />
[Parallel(n_jobs=8)]: Done 434 tasks      | elapsed:  1.5min<br />
[Parallel(n_jobs=8)]: Done 784 tasks      | elapsed:  2.5min<br />
[Parallel(n_jobs=8)]: Done 1234 tasks      | elapsed:  4.1min<br />
[Parallel(n_jobs=8)]: Done 1784 tasks      | elapsed:  6.3min<br />
[Parallel(n_jobs=8)]: Done 2434 tasks      | elapsed:  9.2min<br />
[Parallel(n_jobs=8)]: Done 3184 tasks      | elapsed: 12.4min<br />
[Parallel(n_jobs=8)]: Done 4034 tasks      | elapsed: 16.2min<br />
[Parallel(n_jobs=8)]: Done 4984 tasks      | elapsed: 20.1min<br />
[Parallel(n_jobs=8)]: Done 6034 tasks      | elapsed: 24.6min<br />
[Parallel(n_jobs=8)]: Done 7184 tasks      | elapsed: 29.7min<br />
[Parallel(n_jobs=8)]: Done 8434 tasks      | elapsed: 34.8min<br />
[Parallel(n_jobs=8)]: Done 9784 tasks      | elapsed: 39.6min<br />
[Parallel(n_jobs=8)]: Done 11234 tasks      | elapsed: 44.8min<br />
[Parallel(n_jobs=8)]: Done 12784 tasks      | elapsed: 50.6min<br />
[Parallel(n_jobs=8)]: Done 14434 tasks      | elapsed: 56.6min<br />
[Parallel(n_jobs=8)]: Done 16184 tasks      | elapsed: 63.5min<br />
[Parallel(n_jobs=8)]: Done 17447 out of 17447 | elapsed: 68.6min finished</p>
</section>
<section id="plot-prf-parameter-histograms">
<h3><span class="section-number">3.2.5. </span>Plot pRF parameter histograms<a class="headerlink" href="#plot-prf-parameter-histograms" title="Permalink to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save the pRF parameters</span>

<span class="c1"># Get the parameters from the iterative fit</span>
<span class="n">x</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">iterative_search_params</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">iterative_search_params</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sigma</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">iterative_search_params</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">total_rsq</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">iterative_search_params</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Calculate polar angle and eccentricity maps</span>
<span class="n">polar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
<span class="n">ecc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Examining the shape of the output</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Polar shape: &#39;</span><span class="p">,</span> <span class="n">polar</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Max ecc: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ecc</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Max polar: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">polar</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Max sigma: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Max rsq: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">total_rsq</span><span class="p">))</span> 

<span class="c1"># Save the pRF parameters</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">pRF_params</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">gf</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">pRF_params</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">,</span> <span class="s1">&#39;total_rsq&#39;</span><span class="p">:</span> <span class="n">total_rsq</span><span class="p">}</span>   


<span class="n">save_path</span> <span class="o">=</span> <span class="s1">&#39;/home/... .../fMRIdata/iCORTEX/sub-00/retinotopy/&#39;</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span> <span class="o">+</span> <span class="s1">&#39;pRF_params_lh.npy&#39;</span><span class="p">,</span> <span class="n">pRF_params</span><span class="p">)</span>


<span class="c1"># Plot the time series</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>

<span class="c1"># Plot the left hemisphere time series</span>
<span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ecc</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Eccentricity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>  <span class="c1"># Adjust the limits as needed</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">polar</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Polar angle&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sigma&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>  <span class="c1"># Adjust the limits as needed</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">total_rsq</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;VE&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>  <span class="c1"># Adjust the limits as needed</span>

</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-center"><p><a class="reference internal" href="_images/sub-01_pRF_params_hist.png"><img alt="" class="align-center" src="_images/sub-01_pRF_params_hist.png" style="width: 900px;" /></a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><strong>Distribution of pRF parameters</strong>.</p></td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Plot</span>
<span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">left_ax</span><span class="p">,</span> <span class="n">right_ax</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">72</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>

<span class="n">ny</span><span class="o">.</span><span class="n">cortex_plot</span><span class="p">(</span><span class="n">flatmaps</span><span class="p">[</span><span class="s1">&#39;lh&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="n">left_ax</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">ecc</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
                <span class="n">mask</span><span class="o">=</span><span class="n">total_rsq</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">,</span>
                <span class="n">vmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>


<span class="n">ny</span><span class="o">.</span><span class="n">cortex_plot</span><span class="p">(</span><span class="n">flatmaps</span><span class="p">[</span><span class="s1">&#39;lh&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="n">right_ax</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">polar</span><span class="p">),</span>
                <span class="n">mask</span><span class="o">=</span><span class="n">total_rsq</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;polar_angle_lh&#39;</span><span class="p">)</span>

<span class="n">left_ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">right_ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure>
    <iframe src="https://rawcdn.githack.com/nicogravel/researchLog_template/fd3cc222bb62b3bacf5a2d855a4adaf5748cbc62/docs_local/source/figures/pRF/lh_eccentricity_3D.html" width="100%" height="500px" frameborder="0"></iframe>
</figure>
<figure>
    <iframe src="https://rawcdn.githack.com/nicogravel/researchLog_template/fd3cc222bb62b3bacf5a2d855a4adaf5748cbc62/docs_local/source/figures/pRF/lh_polar_3D.html" width="100%" height="500px" frameborder="0"></iframe>
</figure>
<p>As a proof of concept, we managed to compute retinotopic maps using one subject and one run using prfpy (a python package for pRF mapping). After some adjustments we will have an accurate, minimalistic and completely transparent and clear pipeline to work data in individual native space level.</p>
</section>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="2_fMRI.html" title="Previous document"><span class="section-number">2. </span><span style="color:black">Surface-based fMRI</span></a>
        </li>
        <li>
          <a href="References.html" title="Next document"><span class="section-number">4. </span><span style="color:black">References</span></a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;.
      
      |
      <a href="_sources/3_VFM.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>